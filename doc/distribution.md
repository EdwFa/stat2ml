# Моделирование данных произвольных распределений

## Введение

Из-за математической сложности часто необходимо исследовать свойства статистических методов с помощью методов моделирования (или методов Монте-Карло). В анализе мощности моделирование означает процесс генерации нескольких тысяч случайных выборок, соответствующих определённому распределению, вычисления статистики критерия для каждой выборки и построения распределения этих статистик с целью изучения уровня значимости и мощности процедуры.

Этот модуль позволяет создавать гистограммы для заданного распределения, а также числовую сводку смоделированных данных. Анализируя гистограмму и числовые характеристики, можно определить, обладает ли распределение желаемыми свойствами. Полученная формула распределения может быть использована в процедурах, основанных на моделировании, например, в новых критериях t-теста. Ниже приведены примеры двух распределений, сгенерированных с помощью данной процедуры.

---

## Технические детали

Вероятностное распределение случайной величины определяет вероятность её значений в пределах своей области. Примерами распространённых непрерывных распределений являются нормальное и равномерное распределения. Однако на практике экспериментальные данные часто не соответствуют этим стандартным распределениям, поэтому были предложены другие модели.

Один из самых простых способов создания распределений с заданными характеристиками — комбинирование простых распределений. Например, выбросы можно добавить к распределению, смешав его с данными из распределения с гораздо большей дисперсией. Таким образом, чтобы смоделировать нормально распределённые данные с 5% выбросов, можно сгенерировать 95% выборки из нормального распределения со средним 100 и стандартным отклонением 4, а оставшиеся 5% — из нормального распределения со средним 100 и стандартным отклонением 16.

Используя стандартные обозначения для нормального распределения, составное распределение новой случайной величины \( Y \) можно записать как:

\[
Y \sim \delta(0 \leq X < 0.95) \cdot N(100,4) + \delta(0.95 \leq X \leq 1.00) \cdot N(100,16)
\]

где \( X \) — равномерно распределённая случайная величина на интервале от 0 до 1, \( \delta(z) \) принимает значение 1, если \( z \) истинно, и 0 в противном случае, \( N(100,4) \) — нормально распределённая случайная величина со средним 100 и стандартным отклонением 4, \( N(100,16) \) — нормально распределённая случайная величина со средним 100 и стандартным отклонением 16.

На гистограмме ниже видно, как хвосты распределения расширяются в обе стороны.

---

### Процедура генерации случайной величины \( Y \) из смешанного распределения:

1. Сгенерировать равномерное случайное число \( X \).
2. Если \( X < 0.95 \), то \( Y \) получается путём генерации случайного числа из распределения \( N(100,4) \).
3. Если \( X \geq 0.95 \), то \( Y \) получается из распределения \( N(100,16) \).

Обратите внимание: для каждого значения \( Y \) генерируется только одно равномерное и одно нормальное случайное число.

---

### Общая формула для смешанного распределения:

Для случайной величины \( Y \), образованной из \( k \) распределений с функциями распределения \( F_i(Z_i) \), используется формула:

\[
Y \sim \sum_{i=1}^{k} \delta(a_i \leq X < a_{i+1}) \cdot F_i(Z_i), \quad a_1 = 0 < a_2 < \dots < a_{k+1} = 1
\]

Значения \( a_i \) выбираются так, чтобы выполнялись условия весов. Только одно равномерное и одно другое случайное число генерируются для каждого значения \( Y \). Распределения \( F_i(Z_i) \) могут быть любыми из перечисленных далее.

Поскольку моделируемые статистики используются для проверки гипотез о средних, удобно параметризовать распределения через их средние значения.

---

## Распределения

### Бета-распределение

Плотность бета-распределения задаётся формулой:

\[
f(x) = \frac{\Gamma(A+B)}{\Gamma(A)\Gamma(B)} \left( \frac{x - C}{D - C} \right)^{A-1} \left( 1 - \frac{x - C}{D - C} \right)^{B-1}, \quad A, B > 0, \quad C \leq x \leq D
\]

где \( A \) и \( B \) — параметры формы, \( C \) — минимум, \( D \) — максимум.

Бета-распределение можно задать двумя способами:
- `Beta(A, B, C, D)`
- `BetaMS(Среднее, СтОткл, C, D)`

Если используется `BetaMS`, программа вычисляет \( A \) и \( B \) по формулам:

\[
\text{Среднее} = (D - C) \cdot \frac{A}{A + B} + C
\]
\[
\text{СтОткл} = (D - C) \cdot \sqrt{\frac{AB}{(A + B)^2 (A + B + 1)}}
\]

Форма плотности зависит от значений \( A \) и \( B \):
- \( A < 1, B < 1 \): U-образная форма
- \( 0 < A < 1 \leq B \): J-образная форма
- \( A = 1, B > 1 \): монотонно убывающая плотность
- \( A = 1, B = 1 \): равномерное распределение
- \( A > 1, B > 1 \): одномодальное распределение

Генерация: алгоритм отклонения Чэньга (Devroye, 1986, стр. 438).

---

### Биномиальное распределение

\[
P(X = x) = \binom{n}{x} \pi^x (1 - \pi)^{n - x}, \quad x = 0, 1, 2, \dots, n
\]

Параметризации:
- `Binomial(P, n)`
- `BinomialMS(Среднее, n)`

Если используется `BinomialMS`, то \( P = \text{Среднее} / n \), причём \( 0 < \text{Среднее} < n \).

Генерация: метод обратной функции распределения (CDF).

---

### Распределение Коши

Плотность:

\[
f(x) = \left[ \pi S \left( 1 + \left( \frac{x - M}{S} \right)^2 \right) \right]^{-1}, \quad S > 0
\]

Хотя у распределения Коши нет среднего и дисперсии, \( M \) и \( S \) трактуются как параметры положения (медиана) и масштаба.

Задаётся как `Cauchy(M, S)`.

Генерация: по алгоритму из Johnson, Kotz, Balakrishnan (1994), стр. 327.

---

### Константное распределение

Случайная величина принимает только одно значение \( X \). Задаётся как `Constant(X)`.

---

### Данные с большим количеством нулей

Иногда данные (например, счётчики или денежные суммы) содержат много нулей. Например, чтобы смоделировать экспоненциальные данные с дополнительными нулями, можно использовать:

```
Constant(0)[2]; Exponential(5)[9]
```

На левой гистограмме — чистое экспоненциальное распределение, на правой — с добавлением нулей.

---

### Экспоненциальное распределение

Плотность:

\[
f(x) = \frac{1}{M} e^{-x/M}, \quad x > 0
\]

Задаётся как `Exponential(M)`, где \( M \) — среднее.

Генерация: \( -M \cdot \ln(U) \), где \( U \) — равномерное случайное число.

---

### F-распределение

F-распределение Снедекора — это распределение отношения двух независимых хи-квадрат распределённых величин. Число степеней свободы числителя — \( A \), знаменателя — \( D \).

Задаётся как `F(M, A)`, где \( M \) — среднее, \( A \) — степени свободы числителя. При этом \( M = D / (D - 2) \).

Генерация: сначала генерируется бета-величина \( B(A/2, D/2) \), затем преобразуется в F-величину:

\[
F_{A,D} = \frac{D \cdot B}{A \cdot (1 - B)}
\]

---

### Гамма-распределение

Плотность:

\[
f(x) = \frac{x^{A-1}}{B^A \Gamma(A)} e^{-x/B}, \quad x > 0, A > 0, B > 0
\]

Параметризации:
- `Gamma(A, B)`
- `GammaMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = A \cdot B, \quad \text{СтОткл} = B \sqrt{A}
\]

Генерация:
- при \( A = 1 \): экспоненциальное распределение
- при \( A > 1 \): алгоритм Best (Devroye, стр. 410)
- при \( A < 1 \): алгоритм Vaduva (Devroye, стр. 415)

---

### Распределение Гумбеля (экстремальных значений)

Плотность:

\[
f(x; A, B) = \frac{1}{B} \exp\left( -\frac{x - A}{B} - \exp\left( -\frac{x - A}{B} \right) \right)
\]

Параметризации:
- `Gumbel(A, B)`
- `GumbelMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = A + 0.57722 \cdot B, \quad \text{СтОткл} = \sqrt{1.64493} \cdot B
\]

Генерация:
\[
g_i = A - B \cdot \ln(-\ln(U_i))
\]

---

### Распределение Лапласа (двойное экспоненциальное)

Плотность:

\[
f(x; A, B) = \frac{1}{2B} \exp\left( -\frac{|x - A|}{B} \right)
\]

Параметризации:
- `Laplace(A, B)`
- `LaplaceMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = A, \quad \text{СтОткл} = B \sqrt{2}
\]

Генерация:
\[
x_i = A - B \cdot \text{sign}(U_i) \cdot \ln(1 - 2|U_i|), \quad -0.5 < U_i < 0.5
\]

---

### Логистическое распределение

Плотность:

\[
f(x; A, B) = \frac{\exp\left( -\frac{x - A}{B} \right)}{B \left( 1 + \exp\left( -\frac{x - A}{B} \right) \right)^2}
\]

Параметризации:
- `Logistic(A, B)`
- `LogisticMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = A, \quad \text{СтОткл} = \frac{B \pi}{\sqrt{3}}
\]

Генерация:
\[
x_i = A + B \cdot \ln\left( \frac{U_i}{1 - U_i} \right)
\]

---

### Логнормальное распределение

Плотность:

\[
f(x; A, B) = \frac{1}{x B \sqrt{2\pi}} \exp\left( -\frac{1}{2} \left( \frac{\ln x - A}{B} \right)^2 \right)
\]

Параметризации:
- `Lognormal(A, B)`
- `LognormalMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = \exp\left( A + \frac{B^2}{2} \right), \quad \text{СтОткл} = \exp(2A + B^2) \left( \exp(B^2) - 1 \right)
\]

Генерация:
\[
x_i = \exp(A + B \cdot z_i), \quad z_i \sim N(0,1)
\]

---

### Мультиномиальное распределение

Используется для дискретных величин с конечным числом значений (например, 1, 2, 3, 4, 5). Задаётся как `Multinomial(P1, P2, ..., Pk)`, где \( P_i \) — вероятность появления значения \( i \).

Примеры:
- `Multinomial(1 1 4 1 1)` — 50% значений 3, остальные поровну
- `Multinomial(1 0 1 0 0 0 1)` — равные доли 1, 3 и 7

---

### Данные по шкале Лайкерта

Для генерации данных по 5-балльной шкале Лайкерта:

```
Multinomial(6 1 2 1 5)
```

Веса относительные — программа нормализует их.

---

### Нормальное распределение

Плотность:

\[
f(x) = \phi\left( \frac{x - \mu}{\sigma} \right)
\]

Задаётся как `Normal(M, S)`, где \( M \) — среднее, \( S \) — стандартное отклонение.

Генерация: алгоритм Марсальи и Брея (Devroye, стр. 390).

---

### Распределение Пуассона

\[
P(X = x) = \frac{e^{-M} M^x}{x!}, \quad x = 0, 1, 2, \dots, M > 0
\]

Задаётся как `Poisson(M)`, где \( M \) — среднее.

Генерация: метод обратной CDF.

---

### t-распределение Стьюдента

Распределение отношения стандартной нормальной величины к корню из независимой хи-квадрат величины. Число степеней свободы — \( A \).

Задаётся как `T(M, A)`, где \( M \) — среднее (добавляется к центрированному t-распределению).

Генерация: сначала генерируется бета-величина \( B(A/2, A/2) \), затем:

\[
t = \sqrt{A} \cdot \frac{X - 0.5}{\sqrt{X(1 - X)}}
\]

---

### Распределение Тьюки (Lambda)

Разработано для управления асимметрией и эксцессом. Используется преобразование:

\[
Y = G_g(z) H_h(z) z, \quad X = A + B Y
\]

где \( z \sim N(0,1) \), \( G_g(z) = \frac{\text{sign}(z) |z|^g - 1}{g} \), \( H_h(z) = |z|^{h/2} \)

- \( g = 0 \): симметрично, \( g > 0 \) — асимметрия вправо, \( g < 0 \) — влево
- \( h > 0 \): более тяжёлые хвосты, \( h < 0 \) — концентрация вокруг центра

Задаётся как `TukeyGH(M, SD, g, h)`. Требуется \( 0 \leq h < 0.5 \).

---

### Равномерное распределение

Плотность:

\[
f(x) = \frac{1}{B - A}, \quad A \leq x \leq B
\]

Параметризации:
- `Uniform(A, B)`
- `UniformMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = \frac{A + B}{2}, \quad \text{СтОткл} = \frac{B - A}{\sqrt{12}}
\]

Генерация: генератор Мерсенна-Твистера (цикл > \( 10^{6000} \)).

---

### Распределение Вейбулла

Плотность:

\[
f(x | B, C) = \frac{B}{C} \left( \frac{x}{C} \right)^{B-1} e^{-(x/C)^B}, \quad B > 0, C > 0, x > 0
\]

Параметризации:
- `Weibull(B, C)`
- `WeibullMS(Среднее, СтОткл)`

Формулы:
\[
\text{Среднее} = C \cdot \Gamma\left(1 + \frac{1}{B}\right), \quad \text{СтОткл} = C \cdot \sqrt{\Gamma\left(1 + \frac{2}{B}\right) - \Gamma^2\left(1 + \frac{1}{B}\right)}
\]

Свойства:
- \( B = 1 \): экспоненциальное
- \( B = 2 \): распределение Рэлея
- \( B = 2.5 \): близко к логнормальному
- \( B = 3.6 \): близко к нормальному

---

## Комбинирование распределений

Как показано выше, можно создавать сложные распределения, комбинируя простые. Например, добавление выбросов за счёт смешивания с распределением с большим разбросом.

---

## Создание новых распределений с помощью выражений

Можно комбинировать распределения с помощью арифметических операций.

### Синтаксис:

```
C1 D1 operator1 C2 D2 operator2 C3 D3 ...
```

где:
- \( C_i \) — коэффициенты (числа)
- \( D_i \) — распределения
- `operator` — `+`, `-`, `*`, `/`
- скобки разрешены только внутри определений распределений

### Примеры:

```
Normal(4, 5) – Normal(4, 5)
2 Exponential(3) – 4 Exponential(4) + 2 Exponential(5)
Normal(4, 2) / Exponential(4) - Constant(5)
```

> Примечание: умножение и деление выполняются первыми.

---

## Создание смешанных распределений

Смешанные распределения формируются путём выборки фиксированного процента данных из каждого из нескольких распределений.

### Синтаксис:

```
D1[W1]; D2[W2]; ...; Dk[Wk]
```

где \( D_i \) — распределения, \( W_i \) — веса (положительные числа).

### Примеры:

```
Normal(4, 5)[19]; Normal(4, 50)[1]   // 95% и 5%
Weibull(4, 3)[7]; Constant(0)[3]     // 70% и 30%
Normal(4,2)-Normal(4,3)[2]; Exponential(4)*Exponential(2)[8]
```

> Веса не обязаны суммироваться в 1 — программа нормализует их. Если вес не указан, считается равным 1.

---

## Специальные функции

Применяются после всех операций, в порядке записи.

| Символ | Функция |
|--------|--------|
| `^`    | Квадратный корень модуля: \( \sqrt{|x|} \) |
| `~`    | Логарифм модуля: \( \ln(|x|) \) |
| `&`    | Экспонента: \( e^x \) (если \( x > 70 \), используется \( e^{70} \)) |
| `\|`   | Модуль: \( |x| \) |
| `#`    | Округление до целого |

---

## Примеры

### Пример 1 — Генерация нормальных данных

Генерация 5000 значений из стандартного нормального распределения \( N(0,1) \).

**Настройки:**
- Распределение: `N(0 1)`
- Количество значений: 5000
- Сид: 7718154

**Результат:** гистограмма и описательная статистика. Теоретически: среднее = 0, ст. откл. = 1, асимметрия = 0, эксцесс = 3.

---

### Пример 2 — Загрязнённое нормальное распределение

95% из \( N(100,3) \), 5% из \( N(110,15) \).

**Настройки:**
- Распределение: `N(100 3)[95]; N(110 15)[5]`
- Сид: 6675746

**Результат:** увеличенные стандартное отклонение, асимметрия и эксцесс, появление выбросов.

---

### Пример 3 — Данные по шкале Лайкерта

30% 1, 10% 2, 20% 3, 10% 4, 30% 5.

**Настройки:**
- Распределение: `M(30 10 20 10 30)`
- Сид: 6696889

---

### Пример 4 — Бимодальные данные

Смесь двух нормальных: `N(10 4); N(30 4)` (без весов — поровну).

**Среднее:** около 20, стандартное отклонение увеличено.

---

### Пример 5 — Гамма-распределение с нулями

70% из гамма-распределения `G(10,5)`, 30% — нули.

**Настройки:**
- `G(10 5)[7]; K(0)[3]`
- Сид: 6734736

---

### Пример 6 — Смесь двух распределений Пуассона

60% из \( P(10) \), 40% из \( P(20) \).

**Настройки:**
- `P(10)[60]; P(20)[40]`
- Сид: 6747449

**Среднее:** \( 0.6 \cdot 10 + 0.4 \cdot 20 = 14 \)

---

### Пример 7 — Разность двух экспоненциальных

`E(10) - E(10)`

**Результат:** симметричное распределение, несмотря на асимметрию исходного экспоненциального распределения.

---

## Ссылки

- Devroye, Luc. (1986). *Non-Uniform Random Variate Generation*. Springer-Verlag.
- Matsumoto, M., Nishimura, T. (1998). *Mersenne Twister: A 623-dimensionally equidistributed uniform pseudorandom number generator.* ACM Transactions on Modeling and Computer Simulation.

---

© NCSS, LLC. Все права защищены.

--- 

Если вы хотите, я могу сохранить этот текст в формате `.docx` или `.pdf`.